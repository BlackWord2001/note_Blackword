# 高级绑定 第一章

高级绑定课程对blender基础有一定要求，建议能熟练使用blender后再看高级绑定课程，否测很多操作可能会看不懂。

## 01 Deformation skeleton

### 骨骼名称中英文对照表

__English__ | __中文__
:--- | :---
ROOT| 根
HEAD | 头部
NECK | 脖子
CHEST | 胸部 
SPINE | 脊柱 
HIP | 臀部 
LEG | 腿
SHIN | 小腿
FOOT | 脚
TOE | 脚趾
SHOULDER | 肩膀
ARM | 臂 
FORARM | 前臂 
HAND | 手
FINGER | 手指
THUMB | 拇指

### 骨骼集合分类

#### **Deformation Bones（DEF）（变形骨骼）**

	最直接影响模型几何形状的骨骼。通常和模型的顶点绑定，当骨骼移动时，相关的顶点也会相应地移动，课程中也提到在导出动画到游戏引擎时，只使用deformation bones的信息动画兼容性会更好。
	
#### **Mechanism Bones（MCH）（机制骨骼）**

	这些骨骼用于执行特定的机制，比如模拟物理现象或用于特殊的动画效果。它们自身可能不直接影响模型的变形，但可能会控制或影响其他骨骼。
	
#### **Target Bones（TGT）（目标骨骼）** 

	这些骨骼用作其他骨骼的目标，通常用在IK（Inverse Kinematics，反向动力学）解算中。
	
#### **Control Bones（CTRL）（控制骨骼）** 

	用于用户交互的骨骼。会被用作动画控制器，使得动画师能更容易地控制复杂的骨骼结构。


给角色增加最基本的骨骼，命名以“DEF”开头。以及手臂和腿的部分需要对称镜像的骨骼在名称最后加上`.L` 的后缀名，这样在（编辑模式）下全选骨骼，右键选择（对称）就能识别并创建出 `.R` 后缀的镜像骨骼。



↓ 绑定参考图

![图像](./Images/高级绑定P01-2.png)

↓ 脚骨骼侧面图

![图像](./Images/高级绑定P01-3.png)

↓ 手指

![图像 | 300](./Images/高级绑定P01-4.png)

↓ ROOT骨骼

> 绑定时一定要注意骨骼坐标轴的朝向，Z轴永远朝上或者朝前。
![图像 | 300](./Images/高级绑定P01-5.png)


↓ DEF骨骼最后完成的样子


正视图 | 侧视图
:---: | :---:
![图像](./Images/高级绑定P01-1.png) | ![图像](./Images/高级绑定P01-6.png)

## 02 骨骼管理器

接下来就要使用（Bone Manager）插件对骨骼进行分类管理，

插件下载地址请查看：[Blender-插件.md](../Blender-插件.md)

这部分我们要做的很简单，只需要专门新建一个ROOT层，并选中ROOT骨骼点击右侧的圆圈“○”给放进去就ok了。

![图像](./Images/高级绑定P01-7.png)

## 03 Assigning armature
<a id="03-Assigning-armature"> </a> 

因为绑定的模型可能会导入游戏引擎所以TGT骨骼是专门用来专门控制DEF骨骼的，相当于是一层控制器。

1. 第一步需要我们在（编辑模式）下把除了ROOT骨骼将DEF开头的骨骼全都选中按 <Kbd>Shift</Kbd> + <Kbd>D</Kbd> 复制一份。

2. 把复制出来的骨骼全部放到一个新的层级中，并把层级命名为TGT。

    ![图像](./Images/高级绑定P01-8.png)

3. 隐藏其他层就单独显示TGT骨骼层，然后将TGT层的骨骼全选，按下<Kbd>Ctrl</Kbd> + <Kbd>F2</Kbd> 进行批量重命名把DEF的前缀替换成TGT。

    ![图像](./Images/高级绑定P01-9.png)

4. 清除blender给我们创建的后缀，复制后的物体因为和原物体重名blender会给我们在名称末尾加上.001 .002 ...等编号，现在我们需要删除他。保险起见我们分两步操作

    > 先删除末尾的数字
    ![图像](./Images/高级绑定P01-10.png)

    > 再删除标点
    ![图像](./Images/高级绑定P01-11.png)

5. 然后就是把DEF捆绑在TGT上，这里我们使用约束修改器，先选择DEF再选中相应的TGT骨骼，按下<Kbd>Ctrl</Kbd> + <Kbd>Shift</Kbd> + <Kbd>C</Kbd> 选择（Copy Transforms）复制变换就好了，接下来就是体力活把所有DEF骨骼都绑到对应的TGT骨骼上。

    ![图像](./Images/高级绑定P01-12.png)

    ↓ 添加完（Copy Transforms）约束后就可以在DEF的约束面板看见它

    ![图像](./Images/高级绑定P01-13.png)

6. 在刷权重之前我们需要把ROOT和TGT开头的所有骨骼的（形变）全部关闭，要不然blender会给我们创建这些骨骼的定点组，我们只需要DEF骨骼驱动人物模型就可以了，因此我们并不需要这些顶点组。

    ![图像](./Images/高级绑定P01-14.png)

7. 先选中物体再加选骨骼按下 <Kbd>Ctrl</Kbd> + <Kbd>P</Kbd> 选择（附带空顶点组），就完成物体和骨骼的关联了
   
    ![图像](./Images/高级绑定P01-15.png)

    ↓ 顶点组的名称会和骨骼名称一模一样，简单的模型如机器人等关节分离的模型可以直接在这个面板中使用（指定）按钮创建权重。

    ![图像](./Images/高级绑定P01-16.png)

    （编辑模式）下打开顶点组权重选项，再选择对应的顶点组就能看到直观的权重影响范围。

    ![图像](./Images/高级绑定P01-17.png)

8. 刷权重部分省略....
   
## 04 躯干控制器

把DEF层先给隐藏，只留下TGT和ROOT方便观察

![图像](./Images/高级绑定-18.png)

从（TGT-HIPS）骨骼沿着Y轴挤出一条名为（CTRL-TORSO） 

![图像](./Images/高级绑定-19.png)

新建一个层把他命名为（TORSO）将（CTRL-TORSO）放到这个新建的层中

![图像](./Images/高级绑定-20.png)

复制一根（TGT-HIPS）骨骼并命名为（CTRL-HIPS）用来作为臀部控制，然后选中这根骨骼并使用快捷键 <kbd>Alt</kbd> - <kbd>F</kbd> 来反转他，并把将（CTRL-HIPS）使用设置为 （CTRL-TORSO）的子级。

![图像](./Images/高级绑定-21.png)

再拉出一根名为（CTRL-CHEST）的骨骼用来控制我们胸部或躯干整个上半部分，也设置为CTRL-TORSO的子集。

![图像](./Images/高级绑定-22.png)

把其他层的骨骼都给隐藏只留下TORSO层最后效果如下

![图像](./Images/高级绑定-23.png)

↓ 骨骼父子关系参考如下

![图像](./Images/高级绑定-24.png)

基础的控制骨骼已经创建完毕，接下来就开始实现控制躯干和臀部的功能

1. 先把 _TGT_HIPS_ 的父级设置为 _CTRL_HIPS_

    ![图像](./Images/高级绑定-25.png)

    > 但是现在出现了一个问题，当我们去旋转 _CTRL_HIPS_ 骨骼整个角色都会旋转，这根骨骼的作用是单纯用来控制臀部的接下来将修复这个问题。

    以上问题根本的原因还是因为 _TGT_SPINE_ 的父级是 _TGT_HIPS_ 当这根骨骼旋转的时候同时也会带动 _TGT_SPINE_ 所以会出现臀部以上也跟着一起旋转的效果。解决办法也很简单只需要把 _TGT_SPINE_ 的父级设置为 _CTRL_TORSO_ 就可以了。

    ![图像](./Images/高级绑定-26.png)

2. 先选中 _CTRL-CHEST_ 再加选 _TGT-SPINE_ ，<kbd>Ctrl</kbd> - <kbd>Shift</kbd> - <kbd>C</kbd> → [ __Copy Rotation__ ](https://docs.blender.org/manual/zh-hans/3.6/animation/constraints/transform/copy_rotation.html) 

    - 目标和拥有者都设置为（局部空间）
    - Mix设置为（相加），或者用（偏移）也可以

    以上步骤设置完后就可以使用 _CTRL_SPINE_ 控制 _TGT_SPINE_ 了，_TGT_SPINE_ 也可以单独进行旋转。

    ![图像](./Images/高级绑定-27.png)

    如果没有把Mix设置为（相加）_TGT_SPINE_ 就无法单独旋转。

    ![图像](./Images/高级绑定-28.png)

3. 先选中 _CTRL-CHEST_ 再加选 _TGT-CHEST_ ，<kbd>Ctrl</kbd> - <kbd>Shift</kbd> - <kbd>C</kbd> → [ __Copy Rotation__ ](https://docs.blender.org/manual/zh-hans/3.6/animation/constraints/transform/copy_rotation.html)

    ![图像](./Images/高级绑定-29.png)

    最终效果就是只需要旋转 _CTRL_SPINE_ 就能同时控制 _TGT-SPINE_ 和 _TGT-CHEST_

    ![图像](./Images/高级绑定-30.png)

4. 最后一步我们要来修改骨骼的名称，因为 _TGT_CHEST_ 和 TGT_SPINE 可以直接允许控制腰部胸部的旋转所以我们也给他改名并归类为 CTRL。
   
    - _TGT_CHEST_ → _CTRL_TWEAKS_CHEST_
    - _TGT_SPINE_ → _CTRL_TWEAKS_SPINE_

    以上两根骨骼名称修改完后，再将其分类进 _TORSO_ 骨骼层

    ![图像](./Images/高级绑定-31.png)

## 05 头部和颈部

开始前先打开骨骼的线框显示模式，有利于制作时候的观察！

![图像](./Images/高级绑定-33.png)

在BoneLayers插件面板中先创建一个名为“MCH”的骨骼层，接下来我们创建的MCH开头的骨骼就给他全放在这个层中。

从脖子下方拉出一根骨骼命名未 “MCH-NECK-ROT”

![图像](./Images/高级绑定-32.png)

再复制一根“MCH-NECK-ROT”骨骼缩小后改名为“MCH-NECK-INT-ROT”

![图像](./Images/高级绑定-34.png)

将 “MCH-NECK-INT-ROT” 骨骼设置为 "CTRL-TORSO" 的子级

![图像](./Images/高级绑定-35.png)

再把脖子的控制骨骼 "TGT-NECK" 设置为 "MCH-NECK-INT-ROT" 的子级

![图像 ](./Images/高级绑定-36.png)

先选中 "MCH-NECK-ROT" 再加选  "MCH-NECK-INT-ROT" 然后按下快捷键 <kbd>CTRL</kbd> - <kbd>SHIFT</kbd> - <kbd>C</kbd> 添加骨骼约束

![图像 ](./Images/高级绑定-37.png)

再给其中的 "Copy Rotation" 约束改名为 "Copy Rotation-NECK-FOLLOW" 方便辨认

![图像 ](./Images/高级绑定-38.png)

接下来就是确认 “MCH-NECK-ROT” 的父级是 “CTRL_TWEAKS_CHEST”，如果不是就将他设置为父级。

![图像 ](./Images/高级绑定-39.png)

现在旋转我们的 “CTRL-CHEST” 还没什么效果，我们只需要把脖子骨骼的的 "Copy Rotation-NECK-FOLLOW" 约束下的影响设置为 "0" 就可以了。

![图像 ](./Images/高级绑定-40.png)

最后我们就能做到无论身体怎么旋转，头部始终都是朝着上方屹立不倒。

## 06初见驱动器

驱动器通过函数来控制属性值。

事实上，驱动器由以下部分组成:

- **驱动器配置** ，指定0个，1个或多个使用其他属性或物体变换通道的输入值，并使用预定义的数学函数或自定义的Python表达式将其结合在一起。
    
- **动画** [函数曲线](https://docs.blender.org/manual/zh-hans/3.5/editors/graph_editor/fcurves/introduction.html)，将驱动配置的输出映射到最终值，以应用到被驱动属性。
    

例如，物体1的旋转可以被物体2的位置控制。可以说，物体2的位置驱动物体1旋转。

驱动器不仅可以调用大多数属性值，直接映射到其他属性，而且属性也可以作为数学表达式或者Python脚本的一部分，通过函数进一步调整。

驱动器是构建装备的极其强大的工具，通常用于驱动骨骼变换以及形状键，操作约束和影响修改器，通常使用自定义属性作为输入。

### 驱动器简单使用

首先如下图在场景中创建一个球体和立方体

![驱动器](./images/驱动器-01.png)

给立方体的Z轴缩放右键添加驱动器
![驱动器](./images/驱动器-02.png)

在驱动器面板编辑驱动器会更方便一些，如下图给驱动器添加物体。

![驱动器](./images/驱动器-03.png)

当按照上面的步骤设置完后我们可以向着X轴左右移动我们的球体就会发现正方形Z轴就会缩放，从正方形拉伸成为了长方体。

![驱动器](./images/驱动器-04.png)

没看懂发生了什么的话我来仔细解释一下驱动器的设置，如下图表达式中 var + 1.0 从最终效果上来看其实就是设置一个初始值，var是我们驱动器的变量名称。

如果删除 var后面的内容或者写成 var + 0，那么这两种方法效果是一样的都会使立方体z轴缩放为0被压成一个平面。

物体很简单就是用来控制当前驱动器的目标物体，类型为X位置的意思是让球体沿着X轴移动就会驱动当前驱动器，间隔（空间）就是设置当前目标物体是沿着世界空间的X轴还是自身的局部空间的X轴。

![驱动器](./images/驱动器-05.png)

### 驱动器曲线

驱动器曲线的操作和作用和动画曲线类似，当球体往X轴移动1的时候立方体的Z轴缩放也会相应的被+1；

![驱动器](./images/驱动器-06.png)

![驱动器](./images/驱动器-07.png)

但是当我们手动编辑曲线后这个1:1的变化就能被打破，默认的曲线是一条线性曲线，球体向X轴移动多少立方体的Z轴就相应缩放多少数值。

接下来先学会怎么使用曲线编辑器，曲线的初始坐标位置是0,0 。

![驱动器](./images/驱动器-08.png)

<kbd>Ctrl</kbd> + <kbd>MMB</kbd> 上下左右移动调整曲线编辑器界面的缩放

![驱动器](./images/驱动器-09.png)

<kbd>Ctrl</kbd> + <kbd>RMB</kbd> 可以移动光标的位置，蓝色的十字线就是光标

![驱动器](./images/驱动器-10.png)

现在我们就要开始编辑曲线了，右键后在上下文菜单选择（插入关键帧），但是注意这个关键帧并不是在我们的当前鼠标光标的位置创建的，而是在这条蓝色的十字线上创建的，也就是曲线编辑器的专属光标。

![驱动器](./images/驱动器-11.png)

创建完后，可以把曲线设置为自由，这样会变成贝塞尔曲线会比较好控制。

> 如果你的控制柄并不是贝塞尔曲线的效果可以设置插值模式为（贝塞尔），快捷键 T

![驱动器](./images/驱动器-12.png)

使用快捷键 <kbd>Shift</kbd> + <kbd>D</kbd> 就能直接创建新的关键帧。

![驱动器](./images/驱动器-13.png)

当设置成这样的时候我们再去移动球体的时候，会发现移动相同的距离但是立方体的Z轴会更长，但是越往后移动Z轴反而会反向拉伸。

### 自定义属性

先删除之前所有的内容，再重新创建一个球体和立方体，还是在立方体的z轴上添加驱动器
在球体上物体属性上添加一个（自定义属性）如下图：

![驱动器](./images/驱动器-15.png)
↓ 自定义属性设置

![驱动器](./images/驱动器-14.png) 

如图右键自定义属性选择（复制数据路径）

![驱动器](./images/驱动器-16.png) 

最后再设置一下立方体的驱动器如下图：

![驱动器](./images/驱动器-17.png) 

然后当我们滑动前面创建的自定义属性的时候立方体的长度也会跟着变化，注意现在CUBE-SIZE的参数是0.579

![驱动器](./images/驱动器-18.png) 

立方体默认Z轴缩放是1，所以加上0.579就是1.579

![驱动器](./images/驱动器-19.png) 

## 07 驱动器实战


接下来需要使用驱动器给，头部永远朝上的模式做一个开关方便后续控制。

需要在头顶上创建一根名为“PROPERTIES”的骨骼中文可以翻译为“偏好设置”的骨骼，之后所有的“自定义属性”都会创建在这根骨骼中。

![驱动器](./images/驱动器实战-01.png) 

但是再开始之前需要给头部创建一根像脖子上一样的能让它永远朝上的骨骼，具体可以再去看看上面的《05 头部和颈部》章节，这节内容主要用来对驱动器和自定义参数的实战就不赘述之前已经学过的内容了。
  
↓成品图

![驱动器](./images/驱动器实战-02.png) 

> 因为我在跟教程的时候已经把blender升级到了4.0版本，这个版本更新了骨骼层的管理方式，所以我们将不再需要使用 Bone Manager 插件。

还有一点需要说明的是成品图中骨骼部分已经重新做了分类，如下：

让脖子永远朝上的骨骼全部都放在MCH骨骼集合中；顺便在创建头部朝上骨骼的时候可以参考截图中的命名方式。

↓ 骨骼集合：MCH

![驱动器](./images/驱动器实战-03.png)

↓ 骨骼集合：TORSO-TWEAK

![驱动器](./images/驱动器实战-04.png)

↓ 骨骼集合：TORSO

![驱动器](./images/驱动器实战-05.png)

如下图需要在 “PROPERTIES” 骨骼下创建两个“自定义属性”。

![驱动器](./images/高级绑定P07-1.png)

+ HEAD-FOLLOW：控制头部始终朝上
+ NECK-FOLLOW：控制脖子始终朝上

↓ 驱动器设置

![驱动器](./images/高级绑定P07-2.png)

复制 HEAD-FOLLOW 的（数据路径），然后进入 MCH-INT-HEAD-FOLLOW 的骨骼约束设置

![驱动器](./images/高级绑定P07-3.png)

再打开驱动器编辑器，如下图设置驱动器，再把前面复制的 HEAD-FOLLOW 的数据路径复制到驱动器中。

![驱动器](./images/高级绑定P07-4.png)

NECK-FOLLOW 也和上面一样操作就可以了，这里就不多赘述了。最后把自定义属性中的参数设置为如下图所示，再去转动我们的身体就会发现头部永远朝上了。

![驱动器](./images/高级绑定P07-5.png)

↓ 最终效果

![驱动器](./images/高级绑定P07-6.png)

## 08 IK反向动力学

给腿部增加反向动力学

首先需要先从脚后跟这个位置拉出一根名为 MCH-IK-FOOT.L 的骨骼，这根骨骼就是现在用来控制IK骨的。MCH-IK-FOOT.L 需要断开原来的父级关系，并如下图把父级设置为ROOT骨骼。

![驱动器](./images/高级绑定P08-2.png)

↓ 极向骨骼等设置

![驱动器](./images/高级绑定P08-3.webp)

一定要锁定 TGT-SHIN.L 的 YZ轴，否则腿会出现不自然的弯曲。            

![驱动器](./images/高级绑定P08-4.webp)

↓ 最终效果图

![驱动器](./images/高级绑定P08-1.png)

## 09 脚步控制器

给脚增加控制骨骼，让制作动画和摆pose更易操控。

### IK骨修改

首先第一步按照顺序先选中 `MCH-IK-FOOT.L` 再加选 `TGT-FOOT.L`

![图片](./Images/高级绑定P09-1.webp)

按下快捷键 <kbd>Ctrl</kbd> - <kbd>Alt</kbd> - <kbd>A</kbd> 来对齐骨骼；再调整一下 `MCH-IK-FOOT.L` 的大小得到如下图的结果。

> 缩放的时候需要把变换轴心点设置成（各自的原点），否则会导致骨骼会往两端缩放。

![图片](./Images/高级绑定P09-2.webp)

再依次选中 `MCH-IK-FOOT.L` `TGT-FOOT.L` 然后 <kbd>Ctrl</kbd> - <kbd>Shift</kbd> - <kbd>C</kbd> 给 `TGT-FOOT.L` 添加约束：（复制变换）；

现在它不仅控制了IK，它还允许我们移动和旋转脚部。

![图片](./Images/高级绑定P09-3.webp)

### DEF骨骼修改

当我们把模型导出到其他软件时会出现一些问题，所以我们的解决方案是先把DEF骨骼的父级全部解除。

![图片](./Images/高级绑定P09-4.webp)

最后再将`DEF`所有的骨骼的父级统一设置为`ROOT`。

![图片](./Images/高级绑定P09-5.webp)

### 控制骨骼

接下来我们需要创建一根骨骼叫做`MCH-FOOR-ROLL.L`并清空他的父级；然后再从它的后面再拉出一根`MCH-FOOR-ROLL02.L`的骨骼。

> 注意：注意图中新建骨骼的Z轴朝向，Z轴永远朝前或朝上，如果朝向不对可以在（骨骼编辑模式）中从（N面板）>（条目）中设置（扭转）值。

![图片](./Images/高级绑定P09-6.webp)

然后按照如下图设置父级关系，`MCH-IK-FOOT.L`的父级为`MCH-FOOR-ROLL.L`；`MCH-FOOR-ROLL.L`的父级为`MCH-FOOR-ROLL02.L`。

![图片](./Images/高级绑定P09-7.webp)

绑定的效果如下

旋转和移动`MCH-FOOR-ROLL.L`

![图片](./Images/高级绑定P09-8.webp)

旋转`MCH-FOOR-ROLL02.L`

![图片](./Images/高级绑定P09-9.webp)

### 创建控制器

先创建一根 `CTRL-FOOR-ROLL02.L` 控制骨骼；依次选中`CTRL-FOOR-ROLL02.L`，`MCH-FOOR-ROLL.L`按下快捷键 <kbd>Ctrl</kbd> - <kbd>Shift</kbd> - <kbd>C</kbd> 添加约束，约束中设置把除了X轴以外的影响全部关掉；再把目标和拥有者的空间都改为局部空间。

![图片](./Images/高级绑定P09-10.webp)

再添加一个约束（限定旋转），如图设置把最大值设置为180°；把拥有者的空间设置为（局部空间）

![图片](./Images/高级绑定P09-11.webp)

给`MCH-FOOR-ROLL02.L`也添加相同的约束；有个快捷方法就是可以先选中`MCH-FOOR-ROLL02.L`再加选 `MCH-FOOR-ROLL.L`从3D视图的菜单栏中选择 （姿态）>（约束）>（将约束复制到当前所选骨骼）就可以把`MCH-FOOR-ROLL.L`的约束直接传递到`MCH-FOOR-ROLL02.L`上。

然后只需要按照下图把最小值修改为-180°，最大值设置为0°就可以了。

![图片](./Images/高级绑定P09-12.webp)

接下来要约束脚趾的旋转让其更自然一些，方法很简单只需要如下图给`TGT-TOE.L`添加`Copy Rotation`的约束就行。

- 轴向：只选择X轴是其他轴向开着会产生不符合人体运动的规律弯曲；
- 反转：如果你的骨骼z轴朝向和图中是反的时候可以开启反转；
- Mix：选择相加是为了能让我们手动单独控制脚趾的骨骼；
- 目标/拥有者：因为两根的骨骼朝向是相反的，世界空间下会让脚趾头骨骼强行和脚的骨骼同步方向所以需要改成局部空间；

![图片](./Images/高级绑定P09-13.webp)

> 注意：我文档写到这才发现我把骨骼名称中的 `FOOT`写成了`FOOR`，这是一个低级的错误请自行改正。

然后再单独创建一根`CTRL-FOOT.L`骨骼控制整个脚的位置，再把`CTRL-FOOT.L`设置为`MCH-FOOT-ROLL02.L`’`CTRL-FOOT-ROLL02.L`的父级。

![图片](./Images/高级绑定P09-13.webp)

最后我们把MCH开头的骨骼都放到MCH的骨骼集合中并把MCH隐藏起来，并且只显示我们需要手动控制的骨骼看起来更简洁。

![图片](./Images/高级绑定P09-15.webp)

## 10 修复腿部

再开始之前我要修改一下脚趾头部分骨骼的命名，因为这根骨骼可以单独去控制所以从`TGT-TOE.L`改名为`CTRL-TOE.L`

![图片](./Images/高级绑定P10-1.webp)

如上图当脚移动过远的时候脚和腿部之间会断开，所以我准备让腿部拉伸来解决这个问题。只需要把腿部两根骨骼的IK设置为0.5就可以了。

![图片](./Images/高级绑定P10-2.webp)

不过新的问题也随之而来，一但把脚的位置放远腿部大小也会整体拉大，这并不是我们想要的结果。

首先先复制腿部的骨骼并命名为图中的名称，再把它向-y轴移动0.5的距离，固定好0.5的距离是方便后面可以回归原位。

![图片](./Images/高级绑定P10-3.webp)

依次给两根腿部TGT骨骼增加 `复制位置` `复制旋转` `复制缩放`的约束，然后再取消缩放的xz轴的缩放就能做到我们需要的禁止维度缩放的效果。

![图片](./Images/高级绑定P10-4.webp)

这回人物的腿部怎么拉伸都不会变大了

![图片](./Images/高级绑定P10-5.webp)

然后就是要给`MCH-IK`骨骼给回归原位，我们之前设置的移动是-0.5,我们这次移动0.5让他回归原位。

![图片](./Images/高级绑定P10-6.webp)

### 修复问题

接下来我们要修正一些这次绑定存在的一些问题，如下图当我们脚的位置超过极向骨骼位置的时候ik骨就会出现这种错误。

![图片](./Images/高级绑定P10-7.webp)

所以我们要做的很简单，只需要把`CTRL-POLE-LEG.L`的父级设置为`CTRL-FOOT.L`就行。

![图片](./Images/高级绑定P10-8.webp)

### 重新对称骨骼

先把所有骨骼集合都全部显示；确保没有隐藏的骨骼，选中另一边的腿部骨骼全部删除。

![图片](./Images/高级绑定P10-9.webp)

再选中我们做好控制器的一边的腿部鼠标右键选择（对称），这样两边就变成一样的了。

![图片](./Images/高级绑定P10-10.webp)

### 限制控制器

因为`CTRL-FOOT-ROLL`只会在一个方向上旋转，所以可以把<kbd>Ctrl</kbd> - <kbd>R</kbd> 设置旋转模式为（XYZ欧拉）

![图片](./Images/高级绑定P10-11.webp)

这根骨头因为不会位移和缩放只在x轴旋转，所以可以锁定我们不需要的变换。

> 选中两根骨骼但是锁定按钮只会锁定最后选择的骨骼的属性，所以可以按住 <kbd>Alt</kbd> 进行批量操作。

![图片](./Images/高级绑定P10-12.webp)

### 骨骼分类

现在因为我们腿部大部分骨骼都在TMP中所以最后再把骨骼放到合适的集合中管理。

![图片](./Images/高级绑定P10-13.webp)

首先第一步先把TGT开头的骨骼移动到TGT集合中，还有MCH开头的移动到MCH集合中。

![图片](./Images/高级绑定P10-14.webp)

这下就就只剩下一些CTRL骨了，但是我们并不需要给他移动到CTRL集合中，而是创建一个LEG.L 和 LEG.R 的层把左右腿分别放入其中。

![图片](./Images/高级绑定P10-15.webp)

## 11 旋转模式

了解不同选择模式之间的区别，以及学会什么情况下该用什么旋转 模式。

### 何时使用Euler

用于执行欧拉旋转的轴系统是所谓的欧拉万向轴。支架是一组特定的三个轴。其中的特殊之处在于，轴之间有一个层次关系：其中一个轴位于层次结构的顶部，并且以另外两个轴中的一个作为其直接子轴；同时，这个子轴是剩余轴的父轴，即层次结构最底部的一个。

哪个轴位于顶部，哪个位于中间，哪个位于底部，这取决于特定的欧拉万向轴：它们有六种类型，因为有六种可能的组合： XYZ ， XZY ， YXZ ， YZX ， ZXY和ZYX欧拉旋转模式。使用轴的字母顺序命名这些模式，从层次结构底部的轴开始，最后是顶部的轴。

这些系统的主要问题出现在它们失去相对垂直度的时候。而这发生在中间的轴旋转时，导致底部的轴也随之旋转。当这个底部的轴接近90°（或相等的角度）时，情况不断恶化。在这种情况下，它将保持与层次结构顶部的轴对齐。在那一刻，我们刚刚失去了一个旋转轴。这在制作动画时可能会导致不连续的插值。这种特殊的轴线损失被称为 "万向节锁"。

> 个人总结：当骨骼只需要一个或两个轴向时被开启时使用。

#### 欧拉角的选择

轴1：希望物体的旋转方向

轴2：需要锁定的轴

轴3：赋予骨骼，物体方向的轴

轴1 | 轴2 | 轴3 | 欧拉
:---: | :---: | :---: | :---:
X | Y | Z | Euler
X | Z | Y | Euler
Y | Z | X | Euler
Z | X | Y | Euler
Z | Y | X | Euler

### 何时使用 Quaternion(WXYZ)

在此模式下，旋转也由四个值（ X、Y、Z和W ）定义。X、Y和Z也定义了一个轴，而W则定义了一个角度，但它与轴的角度截然不同。这里重要的是所有四个价值观之间的关系。

为了以直观的方式描述它，让我们来看看X坐标的效果：它所做的是将元素围绕X轴旋转到180度。Y和Z也是如此。W的效果是避免这些旋转并且使元件保持零旋转。最后的方向是这四种效果的组合。

由于组件之间的关系定义了最终方向，将所有四个数字乘以或除以一个恒定值将产生非常相同的旋转。

此模式非常适合在 **任何** 对方向之间插值。它不会受到万向节锁定或任何不希望的插值效应的影响。唯一的缺点是，您无法在距离大于180 °的两个方向之间插值，因为动画将在它们之间走最短的路径。因此，要动画化旋转元素，您必须设置许多中间关键帧，最多彼此180 °。

此模式下的 _Gimbal_ 控件等同于 _Local_ 控件，没有任何特殊含义。

> 个人总结：此模式下的动画曲线不直观，因此也难以理解和编辑。Quaternion 也总是寻找一个方向到另一个方向的最短路径；如果旋转角度超过180°骨骼就会反向旋转，解决这个问题最好的办法就是插入中间帧和更多的关键帧。

## 12 手臂IK/FK

将手臂肩膀手臂手心的的骨骼单独移动到“TMP”骨骼集合，其中不包括手指部分的骨骼。然后把“TMP”以外的集合全部隐藏。

![图片](./Images/高级绑定P12-0.webp)

从TGT骨骼复制两套骨骼分别往上移动0.2m方便之后再回归原位，如图分别改名为“CTRL-FK”和“MCH-IK”开头。

![图片](./Images/高级绑定P12-1.webp)

接下来挤出一根骨骼并把这根骨骼的父级设置为“ROOT”骨

![图片](./Images/高级绑定P12-2.webp)

将“MCH-IK-HAND.L”的父级设置为我们刚刚创建的那根用于IK控制的骨骼。

![图片](./Images/高级绑定P12-3.webp)

创建IK

![图片](./Images/高级绑定P12-4.webp)

设置“IK拉伸”为 0.05，“锁定IK”只有“MCH-IK-FORARM.L”才需要设置。

![图片](./Images/高级绑定P12-5.webp)

创建一根极向目标骨骼，并把他的父级设置为 “CTRL-TORSO”

> 这个可以按照习惯设置除了“CTRL-TORSO”，设置为“ROOT”骨也是可以的。

![图片](./Images/高级绑定P12-6.webp)

然后再到IK约束器中把我们创建的极向骨设置上。

![图片](./Images/高级绑定P12-7.webp)

在这里我们创建了两根骨骼分别为"MCH-ARM-FOLLOW.L"和"MCH-ARM-FOLLOW.L.001"

![图片](./Images/高级绑定P12-9.webp)

把"MCH-ARM-FOLLOW.L.001"的父级设置为”CTRL-TORSO“

![图片](./Images/高级绑定P12-10.webp)

按照顺序添加或者排序创建"MCH-ARM-FOLLOW.L.001"的约束

![图片](./Images/高级绑定P12-11.webp)

我们可以先把“PROPERTIES”这根骨骼设置为每个集合都可见这样就可以方便使用，骨骼集合列表中实心的小圆点就代表这根骨骼在当前层中。

![图片](./Images/高级绑定P12-8.webp)

接下来在“PROPERTIES”骨骼下再添加一个名为"ARM-FOLLOW.L"的自定义参数用来控制IK和FK的切换

![图片](./Images/高级绑定P12-12.webp)

给 "MCH-ARM-FOLLOW.L.001" 的旋转约束的影响增加驱动器，按照如图设置其中Path参数把我们刚刚创建的 ARM-FOLLOW.L参数的数据路径复制进去。

![图片](./Images/高级绑定P12-13.webp)

把 MCH-ARM-FOLLOW.L.001 设置为 "CTRL-FK-ARM.L" 父级

![图片](./Images/高级绑定P12-14.webp)

现在当我们拉动 ARM-FOLLOW.L 的时候就能控制 CTRL-FK 等骨骼

![图片](./Images/高级绑定P12-15.webp)

接下来我们就要开始创建著名的开关了，首先我们要将IK的影响值传递给TGT骨，跟腿部一样 复制位置 复制旋转 和 部分缩放

![图片](./Images/高级绑定P12-16.webp)

但是"TGT-HAND.L"就不太一样只需要一个复制变换的约束器即可。

![图片](./Images/高级绑定P12-17.webp)

### IK/FK切换

接下来要制作FK和IK的切换，这个原理比较简单，如下图当我们在TGT骨骼下绑定了新的约束器的时候也就是我们的FK使用的约束器，这时候FK的约束器就是最终效果权限最高，会把之前用来复制IK变换的约束器给覆盖掉。做FK和IK的切换其实只需要设置最后的FK约束器的效果就行了。

最后把手臂和手掌的骨骼也给加上FK的变换就可以了。

![图片](./Images/高级绑定P12-18.webp)

接下来让我们创建一个自定义属性用来控制FK/IK的切换

![图片](./Images/高级绑定P12-19.webp)

接下来在约束器上创建驱动器，把"ARM IK/FK"的数据路径给复制进驱动器中，现在我们的功能就可以用了，去尝试拉动自定义属性的参数试试。

![图片](./Images/高级绑定P12-20.webp)

接下来我们可以通过复制驱动器到其他的约束上就不需要重新设置了！

![图片](./Images/高级绑定P12-21.webp)

### 将骨骼恢复原位

![图片](./Images/高级绑定P12-22.webp)

如上图我们要把IK和FK的骨骼分别z轴往下移动 0.2m和0.4m，效果如下图

![图片](./Images/高级绑定P12-23.webp)

### 对称

接下来我们要删掉另一边的骨骼，好直接对称过去。所以我们先要确保所有骨骼层都显示，这样不会出现以免漏删。

![图片](./Images/高级绑定P12-24.webp)

然后在删除右边的手臂骨骼

![图片](./Images/高级绑定P12-25.webp)

然后选中左手的所有骨骼对称过去

![图片](./Images/高级绑定P12-26.webp)

在 PROPERTIES 骨骼自定义属性中把原来ARM IK/FK 改名为 ARM IK/FK.L，为了区分左右手。然后再创建一个 ARM IK/FK.R 用于控制右手的FK和IK的切换。最后再创建一个 ARM-FOLLOW.R 对应 ARM-FOLLOW.L。

![图片](./Images/高级绑定P12-27.webp)

复制左臂 ARM-FOLLOW.L 的驱动器

![图片](./Images/高级绑定P12-28.webp)

再选中MCH-ARM-FOLLOW.R.001骨骼把复制的驱动器粘贴到约束中的Copy Rotation-ARM-FOLLOW的 “影响” 中。

然后编辑驱动器把“Path”的路径中的.L修改为.R，这样就把我们上面创建的 ARM-FOLLOW.R 关联上了。

![图片](./Images/高级绑定P12-29.webp)

接下来手臂的IK/FK切换也做一样的操作，先复制左手TGT骨骼的驱动器，再粘贴到右手TGT的骨骼，驱动器路径改为如下：

	pose.bones["PROPERTIES"]["ARM IK/FK.R"]

### 整理骨骼集合

接下来要给骨骼进行分类，先创建以下骨骼集合。

+ ARM FK.L（存放左手FK骨骼）
+ ARM FK.R（存放右手FK骨骼）
+ ARM IK.L（存放左手IK骨骼）
+ ARM IK.R（存放右手IK骨骼）

但是要注意的是以上集合只用来放我们实际需要控制的骨骼，像IK骨只存放实际控制IK的目标骨和极向骨骼，其他不需要手动控制的部分都放进MCH中。

最后再测试一下手臂IK骨和FK骨骼切换等是否工作。

## 13 手部绑定

第一步我们先把手指的骨骼也就是我们需要编辑的骨骼放到 `TMP` 这个骨骼集合。

![图片](./Images/高级绑定P13-1.webp)

### 跟随小拇指旋转

然后在（姿态模式）下选中 `TGT-PALM-A.L` 骨骼使用快捷键 <kbd>Ctrl</kbd> - <kbd>R</kbd> 设置旋转模式为（XYZ欧拉） 

![图片](./Images/高级绑定P13-2.webp)

为无名指的骨骼添加（复制旋转）的骨骼约束如下图设置，把（世界空间）全部换成（局部空间）

![图片](./Images/高级绑定P13-3.webp)

然后依照顺序选择 食指>中指>无名指，让后从3D视图菜单栏中选择 （姿态）>（约束）>（将约束复制到当前所选骨骼）

![图片](./Images/高级绑定P13-4.webp)

接下来修改每根骨骼约束器的印象值，如下图从右往左无名指是0.7，中指是0.3，食指则是0所以我们可以直接把约束删掉。 

![图片](./Images/高级绑定P13-5.webp)

然后去转动小拇指的骨骼会发现手指就像扇子一样展开

![图片](./Images/高级绑定P13-6.webp)

接下来我们需要选中第二排骨骼使用 <kbd>Shift</kbd> - <kbd>D</kbd> 复制骨骼

![图片](./Images/高级绑定P13-7.webp)

再缩放到大致如下图大小

![图片](./Images/高级绑定P13-8.webp)

再挤出一节骨骼

![图片](./Images/高级绑定P13-9.webp)

使用快捷键 <kbd>Ctrl</kbd> - <kbd>Alt</kbd> - <kbd>A</kbd> 对齐骨骼，另外三根手指的骨骼也做同样的操作。

![图片](./Images/高级绑定P13-10.webp)

为第二排骨骼增加复制变换的约束

![图片](./Images/高级绑定P13-11.webp)

为三四排的骨骼增加复制旋转的约束

![图片](./Images/高级绑定P13-12.webp)

其他手指也用相同的操作和对应手指的控制骨骼进行创建驱动器，最后让控制器骨骼旋转后会得到如图效果，手指会直接弯曲。

![图片](./Images/高级绑定P13-13.webp)

接下来也是同样的操作给大拇指也增加一个控制骨骼

![图片](./Images/高级绑定P13-14.webp)

因为如图所示这些骨骼只会围绕一个轴向旋转所以我们再次给他们设置旋转模式为（XYZ欧拉）

![图片](./Images/高级绑定P13-15.webp)

接下来把除了“旋转X轴”以外全部锁定。

![图片](./Images/高级绑定P13-16.webp)

修改骨骼命名

![图片](./Images/高级绑定P13-17.webp)

然后我们要做的就是把另一只手的骨骼删除把这只手的骨骼全部镜像过去。

> 注意事项：记得镜像的时候显示所有的骨骼集合包括DEF层把手的部分删除再镜像过去。

最后一步新建一个名为`HANDS`的骨骼层，只需要把刚刚命名为`CTRL`的骨骼给放进去就行，然后把剩下的骨骼都放回`TGT`中。

## 14

### Rig UI

我没有使用视频教程中的骨骼插件所以没有这部分内容。

### 确保没有其他形变骨骼的存在

显示除DEF外所有的骨骼，全选使用快捷键 <kbd>Shift</kbd> - <kbd>W</kbd> > （形变）> 类型改为（禁用），再次确保除了DEF外没有形变骨。

![图片](./Images/高级绑定P14-1.webp)

### 骨骼颜色

> 注意：在视频教程中是4.0之前的版本会使用（Bone Groups）先对骨骼进行分类再设置颜色。而从4.0开始是直接对每根骨骼单独设置。

4.0版本中骨骼的视图颜色是一根根骨骼单独设置的，所以选中多根骨骼的时候会发现其他骨骼颜色并没有变化，所以我们有两种方法来让其他骨骼获得当前活动骨骼的颜色。

1. 只需要选择颜色的时候一直按住 <kbd> Alt </kbd> 批量操作就可以一起被赋予颜色。
2. 方法二是如下图选择颜色后再点击绿色箭头指向的那个按钮（Copy Colors To Selected）。

    ![图片](./Images/高级绑定P14-2.webp)

最终效果设置为如图所示就差不多了，颜色也可以按照自己的喜好和理解修改。

![图片](./Images/高级绑定P14-3.webp)

# 高级绑定 第二章

第二章会在第一章的基础上修改控制器的样式，也会让骨骼让效果更佳生动和符合运动规律。

## 01 新建骨骼

> 绑定还有一件事情要先对称骨骼后绑定物体。以及第一次就要检查好骨骼的命名，后面修改会导致顶点组权重再镜像失效。

从这章开始我们几乎要从头开始创建骨骼，不过有上次的经验这次速度会快许多。

下图就是我们需要创建的骨骼，这次需要给腿部和手臂以及腰部更多的骨骼。

正视图 | 斜视图
:---: | :---:
![图片](./Images/高级绑定301-1.webp) | ![图片](./Images/高级绑定301-2.webp)

新建DEF和ROOT的骨骼集合把相应的骨骼进行归类

![图片](./Images/高级绑定301-3.webp)

骨骼命名参考，主要注意的就是 躯干，腿，手臂 细分后会在后缀前加上01或02的数字编号来进行相同名称区分。

![图片](./Images/高级绑定301-4.webp)

最后再创建一层TGT骨，创建方法可以去看第一章的03内容 [TGT骨骼创建](#03-Assigning-armature)，所以这部分直接略过了。

最后我们需要把DEF层的骨骼的父级全部断开这点千万别忘记了。

## 02

先创建一根名为 `CTRL-TORSO` 的骨骼并放到名为 `TORSO` 的骨骼集合中。

![图片](./Images/高级绑定302-1.webp)

再复制出一根 `CTRL-TORSO` 骨骼命名为名为 `CTRL-HIPS`，然后再将 `CTRL-HIPS` 的父级设置为 `CTRL-TORSO`。

![图片](./Images/高级绑定302-2.webp)

从尾部拉出如下两根骨骼，并顺便用<kbd>Alt</kbd> - <kbd>P</kbd> 清空这两根骨骼的父级。

![图片](./Images/高级绑定302-3.webp)

然后如下图将如下骨骼 <kbd>Ctrl</kbd> - <kbd>P</kbd> 设置父级

<center> 1 </center>

![图片](./Images/高级绑定302-4.webp)

<center> 2 </center> 

![图片](./Images/高级绑定302-5.webp)

接下来再创建如图位置的三根骨骼

![图片](./Images/高级绑定302-6.webp)

分别命名为 `MCH-HIPS` `MCH-INT-HIPS` `CTRL-TWEAK-HIPS`

![图片](./Images/高级绑定302-7.webp)

再将 `MCH-HIPS` 设置为 `CTRL-HIPS` 的子集

![图片](./Images/高级绑定302-8.webp)

然后把 `MCH-INT-HIPS` `CTRL-TWEAK-HIPS` 设置为 `CTRL-TORSO` 的子集

![图片](./Images/高级绑定302-9.webp)

先选中 `MCH-HIPS` 再 `MCH-INT-HIPS` 然后添加骨骼约束>选择复制变换

![图片](./Images/高级绑定302-10.webp)

然后将影响设置为 `0.5`

![图片](./Images/高级绑定302-10.5.webp)

把 `MCH-INT-HIPS` 设置为 `CTRL-TWEAK-HIPS` 的父级

![图片](./Images/高级绑定302-11.webp)

`TGT-SPINE01` 设置为 `CTRL-TWEAK-HIPS` 的子集

![图片](./Images/高级绑定302-12.webp)

给 `TGT-HIPS` 添加骨骼约束

![图片](./Images/高级绑定302-13.webp)

再对 `TGT-SPINE01` 添加相同的骨骼约束

![图片](./Images/高级绑定302-14.webp)

再把 `TGT-SPINE02` 绑定为  `CTRL-TORSO` 的子集

![图片](./Images/高级绑定302-15.webp)

看到11分20秒

