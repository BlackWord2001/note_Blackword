# 数学函数

中文名 | 函数 | 功能 | 常见应用场景
:---: | :---: | :--- | :---
阶梯函数 | `step()` | 硬过渡，二值化 | 卡通渲染边缘 (Toon Shading)、基于阈值的遮罩、颜色替换。
小数/取碎 | `frac()` | 取小数部分、周期性 | UV 纹理平铺、程序化噪音和波浪的重复、动画的循环计时器。
正弦函数 | `sin()` | 计算输入值的正弦，返回 [−1,1] 范围内的平滑周期值。 | 生成平滑的、来回摆动的变化（振荡）。它通常用于模拟波浪、呼吸效果、脉冲光照或任何需要平滑循环运动的场景。
余弦函数 | `cos()` | 计算输入值的余弦，返回 [−1,1] 范围内的平滑周期值（相位比 sin 提前 90∘）  | 用于平滑振荡效果；与 sin() 结合，共同实现圆周运动（如创建旋转的向量或偏移）。
线性插值 | `lerp()`  `mix()` | 在两个值之间根据权重进行线性混合 | 纹理混合、颜色过渡、雾效强弱控制、材质属性平滑变化。
幂函数 | `pow()` | 计算 x 的 y 次幂 | 镜面光泽度 (Specular)、伽马校正 (Gamma)、菲涅尔效应 (Fresnel)、非线性衰减。
钳制 | `clamp()` | 将数值限制在 min 和 max 之间 | 防止颜色溢出 (HDR处理)、输入值安全检查、限制光照强度。
点积 | `dot()` | 计算两个向量的点积 (标量) | 漫反射光照计算 (Lambert)、视角边缘检测、判断物体朝向前后。
最大值 | `max()` | 取两个值中的较大值 | 避免光照为负数 (max(dot(N,L), 0) )、下限控制。
最小值 | `min()` | 取两个值中的较小值 | 雾效距离上限控制、上限控制。

## step 阶梯函数

示例

表达式|结果|解释
:--- | :--- | :---
step(0.5, 0.2) | 0.0 | 0.2<0.5
step(0.5, 0.5) | 1.0 | 0.5≥0.5
step(0.5, 0.8) | 1.0 | 0.8≥0.5

```hlsl
// 原理：如果 x < edge，返回 0.0；否则返回 1.0
float result = step(edge, x);
```

作用：

+ 硬切边：不像 lerp 那样有过渡，step 是一刀切，非黑即白。
+ 逻辑判断：在 Shader 中替代 if-else 语句（GPU 对分支语句优化不如数学计算），用于根据条件显示不同颜色。

### frac 取小数

示例

表达式|结果|解释
:--- | :--- | :---
frac(1.25)|0.25|1.25−floor(1.25)=1.25−1.0=0.25
frac(3.0)|0.0|3.0−floor(3.0)=3.0−3.0=0.0
frac(-2.7)|0.3|−2.7−floor(−2.7)=−2.7−(−3.0)=0.3
frac(0.999)|0.999|0.999−floor(0.999)=0.999−0.0=0.999

```hlsl
// 原理：返回 x 的小数部分。等同于 x - floor(x)
// 输入 1.2 -> 返回 0.2
// 输入 3.9 -> 返回 0.9
float result = frac(x);
```

作用：
+ 周期性：随着输入值（如时间 Time）不断增加，输出值永远在 0 到 1 之间循环。这是制作流动纹理（UV动画）的核心。
+ 锯齿波：生成用于程序化条纹的锯齿状波形。

## sin / cos (三角函数)

```hlsl
// 原理：输入弧度，输出 [-1, 1] 之间的平滑波形
float y = sin(time);
```

作用：

+ 重映射：通常配合简单的数学运算将范围 [-1, 1] 映射到 [0, 1] 以用于颜色或透明度：sin(time) * 0.5 + 0.5。
+ 顶点动画：在顶点着色器中修改顶点位置，模拟水面波浪或旗帜飘动。

## lerp / mix (线性插值)

```hlsl
// 原理：在a和b之间线性插值
float result = lerp(a, b, t); // = a + (b - a) * t
```
作用：颜色混合、过渡效果、强度控制

## pow (幂函数)

```hlsl
// 原理：求x的y次幂
float result = pow(x, y);
```

作用：对比度调整、伽马校正、非线性衰减

## clamp (钳制/限制)

用于将数值限制在指定的最小值和最大值范围内

```hlsl
color = clamp(color, 0.0, 1.0);
```

作用：

防止数值溢出：颜色值超出0-1范围会导致不可预测的渲染结果

硬件限制：很多显示设备和格式期望颜色在0-1范围内

数学安全：避免后续计算中出现无效的数学操作

## dot （点积 Dot Product）

对于两个向量 a 和 b：
```hlsl
dot(a, b)
```

相当于

```hlsl
a.x * b.x + a.y * b.y + a.z * b.z
```

## max

定义：max(a, b) 返回两个值中较大的那个。

工作原理：
```hlsl
// 标量版本
float max(float a, float b)
{
    return (a > b) ? a : b;
}

// 向量版本（逐分量比较）
float3 max(float3 a, float3 b)
{
    return float3(
        (a.x > b.x) ? a.x : b.x,
        (a.y > b.y) ? a.y : b.y,
        (a.z > b.z) ? a.z : b.z
    );
}
```
示列：
```hlsl
float result1 = max(3.0, 5.0);    // 5.0
float result2 = max(-2.0, 0.0);   // 0.0

float2 vec1 = float2(1.0, 3.0);
float2 vec2 = float2(2.0, 1.0);
float2 result3 = max(vec1, vec2); // (2.0, 3.0)
```


## min

定义：min(a, b) 返回两个值中较小的那个。

工作原理：

```hlsl
// 标量版本
float min(float a, float b)
{
    return (a < b) ? a : b;
}
```

示列：

```hlsl
float result1 = min(3.0, 5.0);    // 3.0
float result2 = min(-2.0, 0.0);   // -2.0

float2 vec1 = float2(1.0, 3.0);
float2 vec2 = float2(2.0, 1.0);
float2 result3 = min(vec1, vec2); // (1.0, 1.0)
```


---

# 一些快捷操作

## Swizzle操作

你可能会在某些代码中看到 `.xxx` 等方式

```hlsl
float luminance = 0.6;        // 单个浮点数值
float3 gray = luminance.xxx;  // 等同于 float3(0.6, 0.6, 0.6)
```

这相当于

```hlsl
float3 gray = float3(luminance, luminance, luminance);
```

`luminance` 是单个浮点数值（标量）

`lerp` 函数需要两个相同维度的向量进行插值

`luminance.xxx` 将标量转换为三维向量，便于与 color 进行插值